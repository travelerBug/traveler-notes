定义
============================================================

图集是将很多零碎的2D小图整合成一张大图，方便unity渲染合批，降低渲染消耗。

### 为什么要打包为图集？

- UI的合批处理，减少DrawCall

​     多张图片需要多次DrawCall，合并成一张大图只需要调用一次DrawCall

- 减少对内存的占用

​		OpenGL每张贴图都需要设置为2的N次方才能使用，假设有宽高分别为100x100、10x10的两张图片，如果不合成大贴图，那么就需要分别使用128x128和16x16的图片，会浪费一部分内存空间。

​		如果是使用一张大图的话，就可以将两张图片打到128x128的图集，进而减少内存的占用。

- 提升效率

​		图片尺寸为2的次幂时，GPU处理起来会快很多，小图不可能做不到每张图都是2的次幂的，但打成一张大图就可以。

### UI 合批流程

遍历UI

合批测试(当前UI会判断底下UI是否可以合批 如果不合批 深度底下最大的+1)

判断顺序 如果深度一样 然后判断材质是否一样 再判断 图片是否一样 最后再根据面板顺序排序，如果深度为-1 则不渲染

得出排序数组 看相邻元素是否一样 然后合批

### 会打断合批的操作

父物体 的 Pos 改变z轴 , 旋转改变 x y 轴，会退出批处理 会打断上下合批(UI和其他UI不在同一平面就不能合批)

### UI 网格重建流程

某ui改变----将此UI设置脏标志---添加脏标志队列--下一帧重建mesh


### **打图集的规则**

- 尽量紧凑，大小不要超过512x512

- Draw Call尽量少，同一个界面的小图尽量在一个图集里

- 内存管理方便，加载性能好，打开一个界面时只加载必要的图集，关闭时可以方便地释放图集

- AssetBundle打包、热更粒度合理，不能出现“热更一个新界面，大量图集都需要热更”的情况

- 设计UI时要考虑重用性，将边框、按钮等共享资源，放在1~3张大图集中，作为重用图集;

- 其它非重用UI按照功能模块进行划分，每个模块使用1~2张图集，作为功能图集;

- 对于部分UI，如果同时用到功能图集与重用图集，但是其功能图集剩下的“空位”较多，则可以将重用图集中用到的元素单独拎出来，合入功能图集中，让UI只依赖于功能图集。通过一定的数据冗余，来实现性能的提升;

**注意控制图集的大小，不要让图集太大，一个超级大图集的DrawCall消耗或许顶的上十几个小图集的消耗**

### 编辑器打包图集

1.Edit → Project Setting → Editor → Project Settings

→Sprite Packer

三种模式

Disabled表示不启用它，

Enabled For Builds 表示只有打包的时候才会启用它，

Always Enabled 表示永远启用它。

设置Always Enabled

2.在Assets下的Images文件夹建立一个图片文件夹test，将集中到图集的图片放置到此文件夹中

3.右键—>Create–>Sprite Atlas，命名为test

4.选择Buttons图集，在Objects for Packing中选择图片文件夹test

点击Pack Previes，图集建立完成。

